name: AI Translator (Final)

on:
  push:
    branches: ["main"]
    paths:
      - '**.md' # Sadece md dosyalarÄ± deÄŸiÅŸince Ã§alÄ±ÅŸÄ±r

permissions:
  contents: write

jobs:
  translate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Python Kurulumu
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: OpenAI KÃ¼tÃ¼phanesi
        run: pip install openai

      - name: Ã‡eviri BaÅŸlat (Python Script)
        env:
          # Secret'Ä± alÄ±p ortam deÄŸiÅŸkenine atÄ±yoruz
          GITHUB_TOKEN: ${{ secrets.OPENAI_API_KEY }}
        shell: python
        run: |
          import os
          import sys
          from openai import OpenAI

          print("--- 1. Ayarlar YÃ¼kleniyor ---")
          
          # SENÄ°N BULDUÄžUN RESMÄ° ADRES:
          endpoint = "https://models.github.ai/inference"
          token = os.environ.get("GITHUB_TOKEN")
          model_name = "gpt-4o"

          if not token:
              print("::error::Token bulunamadi! Secret ayarlarini kontrol et.")
              sys.exit(1)

          print("--- 2. Ä°stemci BaÅŸlatÄ±lÄ±yor ---")
          try:
              client = OpenAI(
                  base_url=endpoint,
                  api_key=token
              )
              
              file_name = "README.md"
              
              if not os.path.exists(file_name):
                  print("README dosyasi yok, islem iptal.")
                  sys.exit(0)

              # DosyayÄ± Oku
              with open(file_name, "r", encoding="utf-8") as f:
                  content = f.read()

              # Linkleri Ekle (Yoksa)
              if "" not in content:
                  print("Linkler ekleniyor...")
                  header = "\n[ ðŸ‡¹ðŸ‡· Turkish ](README.md) | [ ðŸ‡ºðŸ‡¸ English ](translations/en/README.md)\n\n\n"
                  content = header + content
                  with open(file_name, "w", encoding="utf-8") as f:
                      f.write(content)

              print("--- 3. Ã‡eviri YapÄ±lÄ±yor (GitHub Models: gpt-4o) ---")
              response = client.chat.completions.create(
                  messages=[
                      {"role": "system", "content": "You are a professional technical translator. Translate the markdown content to English. Do not explain, just translate."},
                      {"role": "user", "content": content}
                  ],
                  model=model_name,
                  temperature=1.0,
                  max_tokens=4096 
              )
              
              translated_text = response.choices[0].message.content
              
              # Kaydet
              os.makedirs("translations/en", exist_ok=True)
              output_path = f"translations/en/{file_name}"
              
              with open(output_path, "w", encoding="utf-8") as f:
                  f.write(translated_text)
                  
              print(f"--- 4. BAÅžARILI! Dosya kaydedildi: {output_path} ---")

          except Exception as e:
              print(f"::error::Bir hata oluÅŸtu: {e}")
              sys.exit(1)

      - name: DeÄŸiÅŸiklikleri GÃ¶nder
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "ðŸ¤– Ã‡eviri TamamlandÄ±" || echo "DeÄŸiÅŸiklik yok"
          git push
